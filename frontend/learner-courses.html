<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Courses - Edu Fairuzullah LMS</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ“ Edu Fairuzullah</h1>
        <p>Learner Dashboard</p>
    </header>

    <nav>
        <div class="nav-links">
            <a href="learner-courses.html" class="active">My Courses</a>
            <a href="dashboard.html">Admin Dashboard</a>
        </div>
        <div class="user-info">
            <span id="userName"></span>
            <button onclick="logout()" style="background:#dc3545;">Logout</button>
        </div>
    </nav>

    <div class="content">
        <div id="message"></div>

        <h2>ğŸ“š Available Courses</h2>
        <div id="coursesList" class="grid"></div>

        <h2 style="margin-top:40px;">ğŸ“ Course Assessments</h2>
        <div id="assessmentsList" class="grid"></div>
    </div>
</div>

<script src="js/utils.js"></script>
<script src="js/api.js"></script>
<script src="js/auth.js"></script>

<script>
    if (!requireAuth()) return;

    const user = getCurrentUser();
    document.getElementById('userName').textContent = `${user.name} (${user.role})`;

    if (user.role !== 'learner') {
        showMessage('This page is for learners only', 'error');
    }

    // Load all courses
    async function loadCourses() {
        try {
            const courses = await getCourses();

            const list = document.getElementById('coursesList');
            if (courses.length === 0) {
                list.innerHTML = '<p>No courses available.</p>';
                return;
            }

            list.innerHTML = courses.map(course => `
                <div class="card">
                    <h3>${course.title}</h3>
                    <p>${course.description}</p>
                    <p><strong>Educator:</strong> ${course.educatorName}</p>
                    <button onclick="loadAssessments('${course.id}')">
                        View Assessments
                    </button>
                </div>
            `).join('');
        } catch (e) {
            showMessage(e.message, 'error');
        }
    }

    // Load assessments for selected course
    async function loadAssessments(courseId) {
        try {
            const assessments = await getAssessments(courseId);
            const list = document.getElementById('assessmentsList');

            if (assessments.length === 0) {
                list.innerHTML = '<p>No assessments for this course.</p>';
                return;
            }

            list.innerHTML = assessments.map(a => `
                <div class="card">
                    <h3>${a.title}</h3>
                    <p>${a.description || ''}</p>
                    <p><strong>Total Marks:</strong> ${a.totalMarks}</p>
                    <button onclick="submitAssessmentPrompt('${courseId}', '${a.id}')">
                        Submit Assessment
                    </button>
                </div>
            `).join('');
        } catch (e) {
            showMessage(e.message, 'error');
        }
    }

    // Submit assessment
    async function submitAssessmentPrompt(courseId, assessmentId) {
        const content = prompt('Enter your submission text:');
        if (!content) return;

        try {
            const result = await submitAssessment(courseId, assessmentId, {
                studentId: user.uid,
                submissionContent: content
            });

            if (result.message) {
                showMessage('Assessment submitted successfully!', 'success');
            } else {
                showMessage(result.error || 'Submission failed', 'error');
            }
        } catch (e) {
            showMessage(e.message, 'error');
        }
    }

    loadCourses();
</script>

</body>
</html>
